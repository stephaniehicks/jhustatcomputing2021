<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>Statistical Computing: Introduction to machine learning</title>

<meta property="description" itemprop="description" content="A brief intro to the why and what for machine learning"/>

<link rel="canonical" href="https://stephaniehicks.com/jhustatcomputing2021/posts/2021-10-19-introduction-to-machine-learning/"/>
<link rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-10-19"/>
<meta property="article:created" itemprop="dateCreated" content="2021-10-19"/>
<meta name="article:author" content="Stephanie Hicks"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Statistical Computing: Introduction to machine learning"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="A brief intro to the why and what for machine learning"/>
<meta property="og:url" content="https://stephaniehicks.com/jhustatcomputing2021/posts/2021-10-19-introduction-to-machine-learning/"/>
<meta property="og:image" content="https://stephaniehicks.com/jhustatcomputing2021/posts/2021-10-19-introduction-to-machine-learning/../../images/cdi1.png"/>
<meta property="og:image:width" content="960"/>
<meta property="og:image:height" content="600"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Statistical Computing"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Statistical Computing: Introduction to machine learning"/>
<meta property="twitter:description" content="A brief intro to the why and what for machine learning"/>
<meta property="twitter:url" content="https://stephaniehicks.com/jhustatcomputing2021/posts/2021-10-19-introduction-to-machine-learning/"/>
<meta property="twitter:image" content="https://stephaniehicks.com/jhustatcomputing2021/posts/2021-10-19-introduction-to-machine-learning/../../images/cdi1.png"/>
<meta property="twitter:image:width" content="960"/>
<meta property="twitter:image:height" content="600"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Statistical Computing: Introduction to machine learning"/>
<meta name="citation_fulltext_html_url" content="https://stephaniehicks.com/jhustatcomputing2021/posts/2021-10-19-introduction-to-machine-learning/"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2021/10/19"/>
<meta name="citation_publication_date" content="2021/10/19"/>
<meta name="citation_author" content="Stephanie Hicks"/>
<meta name="citation_author_institution" content="Department of Biostatistics, Johns Hopkins"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["creative_commons","title","description","author","date","output","categories","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["CC BY-NC-SA"]},{"type":"character","attributes":{},"value":["Introduction to machine learning"]},{"type":"character","attributes":{},"value":["A brief intro to the why and what for machine learning"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url","affiliation","affiliation_url"]}},"value":[{"type":"character","attributes":{},"value":["Stephanie Hicks"]},{"type":"character","attributes":{},"value":["https://stephaniehicks.com/"]},{"type":"character","attributes":{},"value":["Department of Biostatistics, Johns Hopkins"]},{"type":"character","attributes":{},"value":["https://www.jhsph.edu"]}]}]},{"type":"character","attributes":{},"value":["10-19-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_depth"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]}]}]},{"type":"character","attributes":{},"value":["module 3","week 8","machine learning","R","programming"]},{"type":"character","attributes":{},"value":["https://stephaniehicks.com/jhustatcomputing2021/posts/2021-10-19-introduction-to-machine-learning/"]},{"type":"character","attributes":{},"value":["https://stephaniehicks.com/jhustatcomputing2021/posts/2021-10-19-introduction-to-machine-learning/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["img/bellkor.png","img/boosting.png","img/distance.png","img/dominici_ehp.png","img/euclid.png","img/ipo_market.png","img/lippman.png","img/manhattan.png","img/market_movers.png","img/randomforest.png","img/rf.gif","img/stacking.png","img/yau_chart_reddit.pdf","introduction-to-machine-learning_files/anchor-4.2.2/anchor.min.js","introduction-to-machine-learning_files/bowser-1.9.3/bowser.min.js","introduction-to-machine-learning_files/distill-2.2.21/template.v2.js","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-10-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-11-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-12-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-24-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-25-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-31-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-32-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-34-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-37-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-39-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-40-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-43-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-44-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-46-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-48-1.png","introduction-to-machine-learning_files/figure-html5/unnamed-chunk-9-1.png","introduction-to-machine-learning_files/header-attrs-2.10/header-attrs.js","introduction-to-machine-learning_files/jquery-1.11.3/jquery.min.js","introduction-to-machine-learning_files/popper-2.6.0/popper.min.js","introduction-to-machine-learning_files/tippy-6.2.7/tippy-bundle.umd.min.js","introduction-to-machine-learning_files/tippy-6.2.7/tippy-light-border.css","introduction-to-machine-learning_files/tippy-6.2.7/tippy.css","introduction-to-machine-learning_files/tippy-6.2.7/tippy.umd.min.js","introduction-to-machine-learning_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #2B3851FF; /* #0F2E3D; */
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #2B3851FF; /* #0F2E3D; */
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */




/* -----------div tips------------- */


  div.puzzle, div.fyi, div.demo, div.note {
    padding: 1em;
    margin: 1em 0;
    padding-left: 100px;
    background-size: 70px;
    background-repeat: no-repeat;
    background-position: 15px center;
    min-height: 120px;
    color: #1f5386;
    background-color: #bed3ec;
    border: solid 5px #dfedff;
  }
  
div.puzzle {
  background-image: url("Your-turn.png");
}

div.fyi {
 background-image: url("images/fyi.png");
}

div.demo {
  background-image: url("images/Live-code.png");
}

div.note {
  background-image: url("images/lightbulb.png");
}

  .questions {
    padding: 1em;
    margin: 1em 0;
    padding-left: 100px;
    background-size: 70px;
    background-repeat: no-repeat;
    background-position: 15px center;
    min-height: 50px;
    color: #000000 ;
    background-color: #9BB1BBFF;
    border: solid 5px #000000;
    background-image: url("images/study.png");
  }
  
  
   .resources {
    padding: 1em;
    margin: 1em 0;
    padding-left: 100px;
    background-size: 70px;
    background-repeat: no-repeat;
    background-position: 15px center;
    min-height: 50px;
    color: #000000;
    background-color: #ECBD95FF; /* #e5d468; */
    border: solid 5px #000000;
    background-image: url("images/list.png");
  }

.keyideas{
    padding: 1em;
    margin: 1em 0;
    padding-left: 100px;
    background-size: 70px;
    background-repeat: no-repeat;
    background-position: 15px center;
    min-height: 120px;
    color: #441F29;
    background-color: #E56889;
    border: solid 5px #441F29;
    background-image: url('images/important.png') ;
}

.center {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 50%;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.10/header-attrs.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Introduction to machine learning","description":"A brief intro to the why and what for machine learning","authors":[{"author":"Stephanie Hicks","authorURL":"https://stephaniehicks.com/","affiliation":"Department of Biostatistics, Johns Hopkins","affiliationURL":"https://www.jhsph.edu","orcidID":""}],"publishedDate":"2021-10-19T00:00:00.000+00:00","citationText":"Hicks, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="https://stephaniehicks.com/jhustatcomputing2021">
<img src="../../images/ads2020-small.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">Statistical Computing</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
General Information
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../syllabus.html">Syllabus</a>
<a href="../../schedule.html">Schedule</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Course Materials
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../lectures.html">Lectures</a>
<a href="../../projects.html">Projects</a>
<a href="../../resources.html">Resources</a>
</div>
</div>
<a href="../../index.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="https://github.com/stephaniehicks/jhustatcomputing2021" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Introduction to machine learning</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../lectures.html#category:module_3" class="dt-tag">module 3</a>
  <a href="../../lectures.html#category:week_8" class="dt-tag">week 8</a>
  <a href="../../lectures.html#category:machine_learning" class="dt-tag">machine learning</a>
  <a href="../../lectures.html#category:R" class="dt-tag">R</a>
  <a href="../../lectures.html#category:programming" class="dt-tag">programming</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>A brief intro to the why and what for machine learning</p></p>
</div>

<div class="d-byline">
  Stephanie Hicks <a href="https://stephaniehicks.com/" class="uri">https://stephaniehicks.com/</a> (Department of Biostatistics, Johns Hopkins)<a href="https://www.jhsph.edu" class="uri">https://www.jhsph.edu</a>
  
<br/>10-19-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#pre-lecture-materials">Pre-lecture materials</a>
<ul>
<li><a href="#read-ahead">Read ahead</a></li>
<li><a href="#acknowledgements">Acknowledgements</a></li>
</ul></li>
<li><a href="#learning-objectives">Learning objectives</a></li>
<li><a href="#why-machine-learning">Why machine learning?</a></li>
<li><a href="#what-is-machine-learning">What is machine learning?</a>
<ul>
<li><a href="#notation">Notation</a></li>
<li><a href="#ml-as-an-optimization-problem">ML as an optimization problem</a></li>
<li><a href="#the-parts-of-an-ml-problem">The parts of an ML problem</a></li>
</ul></li>
<li><a href="#example-quickdraw">Example: QuickDraw!</a>
<ul>
<li><a href="#start-with-a-question">Start with a question</a></li>
<li><a href="#goal-setting">Goal setting</a></li>
<li><a href="#data-collection">Data collection</a></li>
<li><a href="#data-loading-and-eda">Data loading and EDA</a></li>
<li><a href="#data-pre-processing">Data pre-processing</a>
<ul>
<li><a href="#feature-engineering">Feature engineering</a></li>
</ul></li>
<li><a href="#splitting-into-training-testing-validation">Splitting into training, testing, validation</a>
<ul>
<li><a href="#overfitting">Overfitting</a></li>
<li><a href="#bias-variance-tradeoff">Bias variance tradeoff</a></li>
<li><a href="#what-do-you-do-in-trainingtuningtesting">What do you do in training/tuning/testing</a></li>
<li><a href="#cross-validation">Cross validation</a></li>
</ul></li>
<li><a href="#model-selection-and-fitting">Model selection and fitting</a>
<ul>
<li><a href="#types-of-models">Types of models</a></li>
<li><a href="#trees">Trees</a></li>
</ul></li>
<li><a href="#model-evaluation">Model evaluation</a></li>
</ul></li>
<li><a href="#post-lecture-materials">Post-lecture materials</a>
<ul>
<li><a href="#additional-resources">Additional Resources</a></li>
</ul></li>
</ul>
</nav>
</div>
<!-- Add interesting quote -->
<h1 id="pre-lecture-materials">Pre-lecture materials</h1>
<h3 id="read-ahead">Read ahead</h3>
<div class="resources">
<p><strong>Before class, you can prepare by reading the following materials:</strong></p>
<ol type="1">
<li><a href="https://rafalab.github.io/dsbook/introduction-to-machine-learning.html" class="uri">https://rafalab.github.io/dsbook/introduction-to-machine-learning.html</a></li>
</ol>
</div>
<h3 id="acknowledgements">Acknowledgements</h3>
<p>Material for this lecture was borrowed and adopted from</p>
<ul>
<li><a href="https://jhu-advdatasci.github.io/2019/lectures/16-intro-ml.html" class="uri">https://jhu-advdatasci.github.io/2019/lectures/16-intro-ml.html</a></li>
<li><a href="https://rafalab.github.io/dsbook/introduction-to-machine-learning.html" class="uri">https://rafalab.github.io/dsbook/introduction-to-machine-learning.html</a></li>
</ul>
<h1 id="learning-objectives">Learning objectives</h1>
<div class="keyideas">
<p><strong>At the end of this lesson you will:</strong></p>
<ul>
<li>Be able to define machine learning (ML) and why we use it?</li>
<li>Be able to recognize some misuses of ML</li>
<li>Understand the parts of a ML problem</li>
<li>Implement a machine learning model to classify images into two types: clouds and axes</li>
</ul>
</div>
<h1 id="why-machine-learning">Why machine learning?</h1>
<p>Today we are going to be talking about machine learning. This is one of the <em>hottest</em> areas in all of statistics/data science. Machine learning is in the news a ton lately. Some examples include:</p>
<ul>
<li><a href="https://towardsdatascience.com/your-guide-to-ai-for-self-driving-cars-in-2020-218289719619">Self driving cars</a></li>
<li><a href="http://science.sciencemag.org/content/353/6301/790">Predicting poverty with satellites</a></li>
<li><a href="https://ai.googleblog.com/2017/03/assisting-pathologists-in-detecting.html">Predicting breast cancer using Google’s DeepMind AI</a></li>
<li><a href="https://www.youtube.com/watch?v=MfThopD7L1Y">Predictive policing</a></li>
</ul>
<p>This is such a big idea that universities are investing major dollars to hire faculty in <a href="https://www.seas.harvard.edu/news/2021/10/seven-join-harvard-computer-science-faculty">AI and machine learning</a>.</p>
<p>On a more personal note you might be interested in AI and machine learning because it is one of the most in demand parts of being a data scientist right now. If you get really good at it <a href="https://www.nytimes.com/2018/04/19/technology/artificial-intelligence-salaries-openai.html">you can make a lot of money</a>.</p>
<p>The other really exciting reason to focus on AI and ML right now is that there is a lot of room for statistical science. Some of the biggest open problems include:</p>
<ul>
<li><a href="https://developers.google.com/machine-learning/fairness-overview/">Fairness in machine learning</a> - tons of work on sampling, causal inference, etc.</li>
<li><a href="https://www.nature.com/articles/d41586-018-07135-0">Morality in machine learning</a> - studies of psychology, bias, reporting.</li>
</ul>
<p>There are a ton more, including how to do EDA for machine learning, understanding the potential confounders and bias, understanding the predictive value of a positive and more.</p>
<h1 id="what-is-machine-learning">What is machine learning?</h1>
<p>Ok so machine learning is super hot right now, but what is machine learning really? You may have learned about the central dogma of statistics that you sample from a population</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:cdi1"></span>
<img src="../../images/cdi1.png" alt="Central dogma of statistics: inference (part 1)" width="60%" />
<p class="caption">
Figure 1: Central dogma of statistics: inference (part 1)
</p>
</div>
</div>
<p>[<a href="https://github.com/jtleek/intro-ml-2018"><strong>Source</strong></a>]</p>
<p>Then you try to guess what will happen in the population from the sample.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:cdi2"></span>
<img src="../../images/cdi2.png" alt="Central dogma of statistics: inference (part 2)" width="60%" />
<p class="caption">
Figure 2: Central dogma of statistics: inference (part 2)
</p>
</div>
</div>
<p>[<a href="https://github.com/jtleek/intro-ml-2018"><strong>Source</strong></a>]</p>
<p>For prediction, we have a similar sampling problem</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:cdp1"></span>
<img src="../../images/cdp1.png" alt="Central dogma of statistics: prediction (part 1)" width="60%" />
<p class="caption">
Figure 3: Central dogma of statistics: prediction (part 1)
</p>
</div>
</div>
<p>[<a href="https://github.com/jtleek/intro-ml-2018"><strong>Source</strong></a>]</p>
<p>But now we are trying to build a rule that can be used to predict a single observation’s value of some characteristic using the others.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:cdp2"></span>
<img src="../../images/cdp2.png" alt="Central dogma of statistics: prediction (part 2)" width="60%" />
<p class="caption">
Figure 4: Central dogma of statistics: prediction (part 2)
</p>
</div>
</div>
<p>[<a href="https://github.com/jtleek/intro-ml-2018"><strong>Source</strong></a>]</p>
<p>We can make this more concrete with a little mathematical notation.</p>
<h3 id="notation">Notation</h3>
<p><em>This section borrowed from Rafa Irizarry’s excellent <a href="https://rafalab.github.io/dsbook/introduction-to-machine-learning.html">Data Science Book</a></em></p>
<p>In machine learning, data comes in the form of:</p>
<ol type="1">
<li>the <strong>outcome</strong> we want to predict and</li>
<li>the <strong>features</strong> that we will use to predict the outcome.</li>
</ol>
<p>Here, we will use <span class="math inline">\(Y\)</span> to denote the outcome and <span class="math inline">\(X_1, \dots, X_p\)</span> to denote features. Note that features are sometimes referred to as predictors or covariates. We consider all these to be synonyms.</p>
<div class="keyideas">
<p><strong>Goal</strong>: we want to build an algorithm that takes feature values as input and returns a prediction for the outcome when we do not know the outcome.</p>
<p>The <strong>machine learning approach</strong> is to <em>train</em> an algorithm using a dataset for which we do know the outcome to <strong>identify patterns in the training data</strong>, and then apply this algorithm in the future to make a prediction when we do not know the outcome.</p>
</div>
<h4 id="types-of-prediction-problems">Types of prediction problems</h4>
<p>Prediction problems can be divided into categorical and continuous outcomes.</p>
<p>For categorical outcomes, <span class="math inline">\(Y\)</span> can be any one of <span class="math inline">\(K\)</span> classes. The number of classes can vary greatly across applications. For example, in the digit reader data, <span class="math inline">\(K=10\)</span> with the classes being the digits 0, 1, 2, 3, 4, 5, 6, 7, 8, and 9. In speech recognition, the outcome are all possible words or phrases we are trying to detect. Spam detection has two outcomes: spam or not spam.</p>
<p>In this lesson, we denote the <span class="math inline">\(K\)</span> categories with indexes <span class="math inline">\(k=1,\dots,K\)</span>. However, for binary data we will use <span class="math inline">\(k=0,1\)</span> for mathematical conveniences.</p>
<h4 id="the-general-set-up">The general set-up</h4>
<p>The general set-up is as follows. We have a series of features and an unknown outcome we want to predict:</p>
<div class="layout-chunk" data-layout="l-body">
<table>
<thead>
<tr class="header">
<th style="text-align: center;">outcome</th>
<th style="text-align: center;">feature_1</th>
<th style="text-align: center;">feature_2</th>
<th style="text-align: center;">feature_3</th>
<th style="text-align: center;">feature_4</th>
<th style="text-align: center;">feature_5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">?</td>
<td style="text-align: center;">X_1</td>
<td style="text-align: center;">X_2</td>
<td style="text-align: center;">X_3</td>
<td style="text-align: center;">X_4</td>
<td style="text-align: center;">X_5</td>
</tr>
</tbody>
</table>
</div>
<p>To <em>build a model</em> that provides a prediction for any set of values <span class="math inline">\(X_1=x_1, X_2=x_2, \dots X_5=x_5\)</span>, we collect data for which we know the outcome:</p>
<div class="layout-chunk" data-layout="l-body">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">outcome</th>
<th style="text-align: left;">feature_1</th>
<th style="text-align: left;">feature_2</th>
<th style="text-align: left;">feature_3</th>
<th style="text-align: left;">feature_4</th>
<th style="text-align: left;">feature_5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Y_1</td>
<td style="text-align: left;">X_1,1</td>
<td style="text-align: left;">X_1,2</td>
<td style="text-align: left;">X_1,3</td>
<td style="text-align: left;">X_1,4</td>
<td style="text-align: left;">X_1,5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Y_2</td>
<td style="text-align: left;">X_2,1</td>
<td style="text-align: left;">X_2,2</td>
<td style="text-align: left;">X_2,3</td>
<td style="text-align: left;">X_2,4</td>
<td style="text-align: left;">X_2,5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Y_3</td>
<td style="text-align: left;">X_3,1</td>
<td style="text-align: left;">X_3,2</td>
<td style="text-align: left;">X_3,3</td>
<td style="text-align: left;">X_3,4</td>
<td style="text-align: left;">X_3,5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Y_4</td>
<td style="text-align: left;">X_4,1</td>
<td style="text-align: left;">X_4,2</td>
<td style="text-align: left;">X_4,3</td>
<td style="text-align: left;">X_4,4</td>
<td style="text-align: left;">X_4,5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Y_5</td>
<td style="text-align: left;">X_5,1</td>
<td style="text-align: left;">X_5,2</td>
<td style="text-align: left;">X_5,3</td>
<td style="text-align: left;">X_5,4</td>
<td style="text-align: left;">X_5,5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Y_6</td>
<td style="text-align: left;">X_6,1</td>
<td style="text-align: left;">X_6,2</td>
<td style="text-align: left;">X_6,3</td>
<td style="text-align: left;">X_6,4</td>
<td style="text-align: left;">X_6,5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Y_7</td>
<td style="text-align: left;">X_7,1</td>
<td style="text-align: left;">X_7,2</td>
<td style="text-align: left;">X_7,3</td>
<td style="text-align: left;">X_7,4</td>
<td style="text-align: left;">X_7,5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Y_8</td>
<td style="text-align: left;">X_8,1</td>
<td style="text-align: left;">X_8,2</td>
<td style="text-align: left;">X_8,3</td>
<td style="text-align: left;">X_8,4</td>
<td style="text-align: left;">X_8,5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Y_9</td>
<td style="text-align: left;">X_9,1</td>
<td style="text-align: left;">X_9,2</td>
<td style="text-align: left;">X_9,3</td>
<td style="text-align: left;">X_9,4</td>
<td style="text-align: left;">X_9,5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Y_10</td>
<td style="text-align: left;">X_10,1</td>
<td style="text-align: left;">X_10,2</td>
<td style="text-align: left;">X_10,3</td>
<td style="text-align: left;">X_10,4</td>
<td style="text-align: left;">X_10,5</td>
</tr>
</tbody>
</table>
</div>
<p>We use the notation <span class="math inline">\(\hat{Y}\)</span> to denote the prediction. We use the term <em>actual outcome</em> to denote what we ended up observing. So we want the prediction <span class="math inline">\(\hat{Y}\)</span> to match the <em>actual outcome</em>.</p>
<h3 id="ml-as-an-optimization-problem">ML as an optimization problem</h3>
<p>The central problem in machine learning can be thus written very simply as minimizing a distance metric. Let <span class="math inline">\(\hat{Y} = f(\vec{X})\)</span> then our goal is to minimize the distance from our estimated function of the predictors to the actual value.</p>
<p><span class="math display">\[d(Y - f(\vec{X}))\]</span></p>
<p><span class="math inline">\(d(\cdot)\)</span> could be something as simple as the mean squared distance or something much more complex. The bulk of machine learning research in theoretical computer science and statistics departments focuses on defining different values of <span class="math inline">\(d\)</span> and <span class="math inline">\(f\)</span>. We will talk a bit more about this in the next lesson.</p>
<h3 id="the-parts-of-an-ml-problem">The parts of an ML problem</h3>
<p>A machine learning problem consists of a few different parts and its important to consider each one. To solve a (standard) machine learning problem you need:</p>
<ol type="1">
<li>A data set to train from.</li>
<li>An algorithm or set of algorithms you can use to try values of <span class="math inline">\(f\)</span> (e.g. logistic regression, random forest, support vector machine)</li>
<li>A distance metric <span class="math inline">\(d\)</span> for measuring how close <span class="math inline">\(Y\)</span> is to <span class="math inline">\(\hat{Y}\)</span> (e.g. mean squared error)</li>
<li>A definition of what a “good” distance is (e.g. different types of performance metrics)</li>
</ol>
<p>While each of these components is a <em>technical</em> problem, there has been a ton of work addressing those technical details. The most pressing open issue in machine learning is realizing that though these are <em>technical</em> steps they are not <em>objective</em> steps.</p>
<div class="keyideas">
<p>In other words, how you choose the data, algorithm, metric, and definition of “good” says what you value and can dramatically change the results. A couple of cases where this was a big deal are:</p>
<ol type="1">
<li><a href="https://www.propublica.org/article/machine-bias-risk-assessments-in-criminal-sentencing">Machine learning for recidivism</a> - people built ML models to predict who would re-commit a crime. But these predictions were based on historically biased data which led to biased predictions about who would commit new crimes.</li>
<li><a href="https://www.nature.com/articles/d41586-018-07135-0">Deciding how self driving cars should act</a> - self driving cars will have to make decisions about how to drive, who they might injure, and how to avoid accidents. Depending on our choices for <span class="math inline">\(f\)</span> and <span class="math inline">\(d\)</span> these might lead to wildly different kinds of self driving cars.</li>
</ol>
<p><strong>Try out</strong> the <a href="http://moralmachine.mit.edu/">moralmachine</a> to see how this looks in practice.</p>
</div>
<h1 id="example-quickdraw">Example: QuickDraw!</h1>
<p>Quick,Draw! is an online game where you are given an object to draw (like a cello, axe, airplane, etc.) and then you have to draw it with your finger. Then a pre-trained deep learning algorithm is applied to guess what kind of a drawing you have made. You can try it out here.</p>
<ul>
<li><a href="https://quickdraw.withgoogle.com/" class="uri">https://quickdraw.withgoogle.com/</a></li>
</ul>
<p>One <strong>interesting thing</strong> about this project and something to keep in mind if you are thinking about ways to get cool data is the exchange that Google is making here. They are giving you a fun game to play for free and in return you are giving them a ton of free data. This is the same exchange made by other successful startups:</p>
<ul>
<li><a href="https://www.google.com/recaptcha/intro/v3.html">reCAPTCHA</a> you click on images to prove you are a human, they give you access to a website.</li>
<li><a href="https://www.duolingo.com/">DuoLingo</a> you practice learning words, they collect information on the way you say those words or your translations</li>
</ul>
<p>Before going any further, we load a few R packages we will need</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://here.r-lib.org/'>here</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/djvanderlaan/LaF'>LaF</a></span><span class='op'>)</span>  <span class='co'># Fast Access to Large ASCII Files</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/topepo/caret/'>caret</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>rjson</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tibble.tidyverse.org/'>tibble</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://hbiostat.org/R/Hmisc/'>Hmisc</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyr.tidyverse.org'>tidyr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.milbo.org/rpart-plot/index.html'>rpart.plot</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>pheatmap</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="keyideas">
<p>The <strong>main steps in a machine learning problem</strong> are:</p>
<ol type="1">
<li>Question definition</li>
<li>Goal setting</li>
<li>Data collection</li>
<li>Training/testing/validation splits</li>
<li>Data exploration</li>
<li>Data processing</li>
<li>Model selection and fitting</li>
<li>Model evaluation</li>
</ol>
</div>
<p>We will use the Quick, Draw! dataset to discuss a few different parts of the ML process.</p>
<h2 id="start-with-a-question">Start with a question</h2>
<p>This is the most commonly missed step when developing a machine learning algorithm. ML can very easily be turned into an engineering problem. Just dump the outcome and the features into a black box algorithm and viola!</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="../../images/choc-nobel.jpg" width="90%" style="display: block; margin: auto;" /></p>
</div>
<p>But this kind of thinking can lead to major problems. In general good ML questions:</p>
<ol type="1">
<li>Have a plausible explanation for why the features predict the outcome.</li>
<li>Consider potential variation in both the features and the outcome over time</li>
<li>Are consistently re-evaluated on criteria 1 and 2 over time.</li>
</ol>
<p>For example, there is a famous case where Google predicted Flu outbreaks based on search results. But the way people searched (due to changes in the algorithm, changes in culture, or other unexplained reasons) led to variation in the search terms people were using. This led to the algorithm predicting <a href="https://gking.harvard.edu/files/gking/files/0314policyforumff.pdf">wildly badly</a> over time.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="../../images/gft.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<p>This is just one example of a <a href="http://tylervigen.com/spurious-correlations">spurious correlation</a>, which is one of the big worries. In general all of the <a href="https://jhu-advdatasci.github.io/2019/lectures/07-being-skeptical.html">reasons for skepticism</a> apply here.</p>
<div class="questions">
<p>In our QuickDraw! example, there are a ton of interesting analyses you could do with these data, but we are going to start with something simple. <strong>Can we predict from the drawing data what kind of object was drawn?</strong> To make matters even simpler we are going to just look at a couple of types of images: axes and clouds.</p>
</div>
<h2 id="goal-setting">Goal setting</h2>
<p>One important part of any machine learning problem is defining what success looks like. This choice very much depends on the application and what you are trying to do.</p>
<p>For example, when we talk about the goal in ML we are usually talking about the error rate we want to minimize and how small we want to make it. Consider for each observation we have an outcome <span class="math inline">\(y\)</span> and a set of features <span class="math inline">\(\vec{x}\)</span>. Our goal is to create a function <span class="math inline">\(\hat{y} = \hat{f}(\vec{x})\)</span> such that the distance, <span class="math inline">\(d(y,\hat{f}(\vec{x}))\)</span>, between the observed and the predicted <span class="math inline">\(y\)</span> is minimized.</p>
<p>The two most common distances that show up in machine learning (and the ones you will always be using if you don’t change the defaults!) are:</p>
<ul>
<li><strong>Root mean squared error (RMSE)</strong> - this is the most common error measure for regression (read: continuous outcome) problems.
<ul>
<li><span class="math inline">\(d(y,\hat{f}(\vec{x})) = \sqrt{\sum_i \left(y_i-\hat{f}(\vec{x}_i)\right)^2}\)</span></li>
</ul></li>
<li><strong>Accuracy</strong> - this is the most common error measure for classification (read: factor outcomes) problems.
<ul>
<li><span class="math inline">\(d(y,\hat{f}(\vec{x})) = \sum_i 1\left(y=\hat{f}(\vec{x})\right)\)</span></li>
</ul></li>
</ul>
<p>Here we are going to use simple accuracy and say that anything better than guessing is “good enough”.</p>
<p>But in general there are a number of other potential error measures:</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="../../images/errors.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>Here are a few examples of how they might be relevant.</p>
<ul>
<li><strong>Predictive value of a positive</strong> - in classification if one group is much less frequent than another, then even high sensitivity/high specificity tests can produce lots of false positives (the classic example is cancer screening, but very relevant for any screening problem).</li>
<li><strong>Mean absolute error</strong> - in regression sometimes you want your error to be less sensitive to a few outliers (this might be true in predicting highly skewed outcomes like income or property values) and MAE can reduce the influence of those outliers.</li>
<li><strong>Specificity</strong> - when the cost of a false negative is really high compared to a false positive and you never want to miss any negatives (say for example missing a person standing in front of a self driving car)</li>
</ul>
<p>In general you need to spend a good amount of time thinking about what the <em>goal</em> is, what the tradeoff of various different errors are and then build that into your model.</p>
<h2 id="data-collection">Data collection</h2>
<p>Here we’ll focus on one somewhat unique issue that arises often in ML problems - the data are often huge and not sampled randomly.</p>
<div class="questions">
<p><strong>Questions</strong>:</p>
<ul>
<li><p>We know that a 5% random sample is better than a 5% non-random sample in measurable ways (e.g. bias, uncertainty assessment).</p></li>
<li><p>But is an 80% non-random sample “better” than a 5% random sample in measurable terms? 90%? 95%? 99%? (Jeremy Wu 2012)</p></li>
<li><p>“Which one should we trust more: a 1% survey with 60% response rate or a non-probabilistic dataset covering 80% of the population?” (Keiding and Louis, 2016, Journal of Royal Statistical Society, Series B)</p></li>
</ul>
</div>
<p>There is a pretty detailed, but really <a href="https://statistics.fas.harvard.edu/files/statistics-2/files/statistical_paradises_and_paradoxes.pdf">good paper</a> addressing this question by Xiao-Li Meng.</p>
<p>The <strong>surprising answer</strong> is that it depends! If there is correlation between the outcome value and the sampling probability even huge data sets can actually be very small in “effective sample size”. So it is worth thinking <em>very hard</em> about potential correlation between the outcome and the (designed or de facto) sampling scheme.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="../../images/ss-bigdata.png" width="60%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="back-to-quick-draw">Back to quick draw</h4>
<p>OK back to our example. Google has released <a href="https://github.com/googlecreativelab/quickdraw-dataset">some of the data</a> from the Quick, Draw! challenge. You can either get the data in raw form or you can get some pre-processed data.</p>
<p>I downloaded the pre-processed data sets for clouds and axes. These data are available from <a href="https://console.cloud.google.com/storage/browser/quickdraw_dataset/full/simplified">Google Cloud Platform</a>.</p>
<ul>
<li>Align the drawing to the top-left corner, to have minimum values of 0.</li>
<li>Uniformly scale the drawing, to have a maximum value of 255.</li>
<li>Resample all strokes with a 1 pixel spacing.</li>
<li>Simplify all strokes using the Ramer–Douglas–Peucker algorithm (strokes are simplified) with an epsilon value of 2.0.</li>
</ul>
<p>All these things make data easier to manage and to represent into a plot. This already represents a lot of work, but even so we still have some more pre-processing to do.</p>
<p>First, we are going to load some of the data into R, it comes in <a href="http://ndjson.org/">ndjson</a> format and there are lots of drawings.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'>if</span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"axe.ndjson"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>file_url_axe</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"https://storage.googleapis.com/quickdraw_dataset/full/simplified/axe.ndjson"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/download.file.html'>download.file</a></span><span class='op'>(</span><span class='va'>file_url_axe</span>, 
                destfile<span class='op'>=</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"axe.ndjson"</span><span class='op'>)</span><span class='op'>)</span>

  <span class='va'>file_url_cloud</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"https://storage.googleapis.com/quickdraw_dataset/full/simplified/cloud.ndjson"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/download.file.html'>download.file</a></span><span class='op'>(</span><span class='va'>file_url_cloud</span>, 
                destfile<span class='op'>=</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"cloud.ndjson"</span><span class='op'>)</span><span class='op'>)</span>

<span class='op'>}</span>
<span class='fu'><a href='https://rdrr.io/r/base/list.files.html'>list.files</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] &quot;2016-07-19.csv.bz2&quot;       &quot;axe.ndjson&quot;              
 [3] &quot;bmi_pm25_no2_sim.csv&quot;     &quot;chicago.rds&quot;             
 [5] &quot;Chinook.sqlite&quot;           &quot;chopped.RDS&quot;             
 [7] &quot;cloud.ndjson&quot;             &quot;flights.csv&quot;             
 [9] &quot;maacs_sim.csv&quot;            &quot;nycflights13&quot;            
[11] &quot;storms_2004.csv.gz&quot;       &quot;team_standings.csv&quot;      
[13] &quot;tuesdata_rainfall.RDS&quot;    &quot;tuesdata_temperature.RDS&quot;</code></pre>
</div>
<p>Next, we are going to read in 100 drawings of each class using the <code>sample_lines()</code> function from the <code>LaF</code> package.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span>
<span class='va'>axes_json</span> <span class='op'>=</span> <span class='fu'>LaF</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/LaF/man/sample_lines.html'>sample_lines</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>,<span class='st'>"axe.ndjson"</span><span class='op'>)</span>, n <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span> 
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span>
<span class='va'>clouds_json</span> <span class='op'>=</span> <span class='fu'>LaF</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/LaF/man/sample_lines.html'>sample_lines</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>,<span class='st'>"cloud.ndjson"</span><span class='op'>)</span>, n <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="data-loading-and-eda">Data loading and EDA</h2>
<p>Before we talk about data exploration and processing, it is important to <em>look</em> at your data and <em>think</em> about what you find in it.</p>
<div class="keyideas">
<p>Also, I want to point out you should do this exploration only in the training set. However, in this example, we are going split the data at a later point.</p>
<p>If you want to know more about this concept, read about <a href="https://en.wikipedia.org/wiki/Leakage_(machine_learning)">data leakage</a>.</p>
</div>
<p>OK the data are not in a format we can do anything with yet. Each line is a json object:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>axes_json</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] &quot;{\&quot;word\&quot;:\&quot;axe\&quot;,\&quot;countrycode\&quot;:\&quot;US\&quot;,\&quot;timestamp\&quot;:\&quot;2017-01-23 21:25:30.06067 UTC\&quot;,\&quot;recognized\&quot;:true,\&quot;key_id\&quot;:\&quot;4842320119726080\&quot;,\&quot;drawing\&quot;:[[[69,74,75,73,70,79,98,105,111,110,70],[76,92,118,239,252,255,252,208,133,73,66]],[[70,57,20,0,28,91,107,114,115,140,134,123,116,112],[66,74,87,0,17,31,45,59,78,95,75,55,50,37]],[[45,50,48],[20,51,74]]]}&quot;</code></pre>
</div>
<p>So the next thing I did was google <a href="https://www.google.com/search?q=quick+draw+data+ndjson+rstats">“quick draw data ndjson rstats”</a>. I found <a href="https://fronkonstin.com/2018/07/01/exploring-the-quick-draw-dataset-with-r-the-mona-lisa/">a tutorial</a> and lifted some code for processing ndjson data into data frames.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>parse_drawing</span> <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>list</span><span class='op'>)</span>
<span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>list</span><span class='op'>$</span><span class='va'>drawing</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span> <span class='op'>{</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>z</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, y<span class='op'>=</span><span class='va'>z</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span><span class='op'>}</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span>.id <span class='op'>=</span> <span class='st'>"line"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>drawing<span class='op'>=</span><span class='va'>list</span><span class='op'>$</span><span class='va'>key_id</span>, row_id<span class='op'>=</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/ranking.html'>row_number</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Using this code I can get our first axe out</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>first_axe</span> <span class='op'>=</span> <span class='fu'>rjson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rjson/man/fromJSON.html'>fromJSON</a></span><span class='op'>(</span><span class='va'>axes_json</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>parse_drawing</span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>first_axe</span>
</code></pre>
</div>
<pre><code># A tibble: 28 × 5
   line      x     y drawing          row_id
   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;int&gt;
 1 1        69    76 4842320119726080      1
 2 1        74    92 4842320119726080      2
 3 1        75   118 4842320119726080      3
 4 1        73   239 4842320119726080      4
 5 1        70   252 4842320119726080      5
 6 1        79   255 4842320119726080      6
 7 1        98   252 4842320119726080      7
 8 1       105   208 4842320119726080      8
 9 1       111   133 4842320119726080      9
10 1       110    73 4842320119726080     10
# … with 18 more rows</code></pre>
</div>
<p>Ok this doesn’t look like much, but we could plot it to see if it looks like an axe.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>first_axe</span>,<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>255</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_reverse</a></span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>255</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-9-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>This sort of looks ok, but maybe a better way to look at it is to actually draw the lines.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>first_axe</span>,<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>group <span class='op'>=</span> <span class='va'>line</span><span class='op'>)</span>, lwd<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>255</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_reverse</a></span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>255</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-10-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>Hey that sort of looks like an axe! Let’s see another one.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>rjson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rjson/man/fromJSON.html'>fromJSON</a></span><span class='op'>(</span><span class='va'>axes_json</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>parse_drawing</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>group <span class='op'>=</span> <span class='va'>line</span><span class='op'>)</span>, lwd<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>255</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_reverse</a></span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>255</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-11-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>If we were doing this for real, I’d make plots for a large sample of these, understand the variation (and look for mislabeled drawings, messed up observations, etc.).</p>
<p>Next let’s look at a cloud</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>rjson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rjson/man/fromJSON.html'>fromJSON</a></span><span class='op'>(</span><span class='va'>clouds_json</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>parse_drawing</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>group <span class='op'>=</span> <span class='va'>line</span><span class='op'>)</span>, lwd<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>255</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_reverse</a></span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>255</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-12-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>Yup, looks like a cloud!</p>
<h2 id="data-pre-processing">Data pre-processing</h2>
<h3 id="feature-engineering">Feature engineering</h3>
<p>One of the key issues in building a model is feature engineering. Feature engineering is a step in a machine learning model where we construct the covariates (or features, <span class="math inline">\(\vec{x}\)</span>) that you will feed into the prediction algorithms.</p>
<p>In general, feature engineering is particularly important for “unstructured” data. For example taking a pile of text like this Emily Dickenson quote from the <a href="https://www.tidytextmining.com/tidytext.html">tidy text tutorial</a>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/juliasilge/tidytext'>tidytext</a></span><span class='op'>)</span>
<span class='va'>text</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Because I could not stop for Death -"</span>,
          <span class='st'>"He kindly stopped for me -"</span>,
          <span class='st'>"The Carriage held but just Ourselves -"</span>,
          <span class='st'>"and Immortality"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>And turn it into something like counts of each word</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>text_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>line <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span>, text <span class='op'>=</span> <span class='va'>text</span><span class='op'>)</span>

<span class='va'>text_df</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/pkg/tidytext/man/unnest_tokens.html'>unnest_tokens</a></span><span class='op'>(</span><span class='va'>word</span>, <span class='va'>text</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>word</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 19 × 2
   word            n
   &lt;chr&gt;       &lt;int&gt;
 1 and             1
 2 because         1
 3 but             1
 4 carriage        1
 5 could           1
 6 death           1
 7 for             2
 8 he              1
 9 held            1
10 i               1
11 immortality     1
12 just            1
13 kindly          1
14 me              1
15 not             1
16 ourselves       1
17 stop            1
18 stopped         1
19 the             1</code></pre>
</div>
<p>This used to be something that was almost exclusively done by expert humans, but is now often done by deep learning algorithms which do “automatic feature selection”.</p>
<p>Back to our data above, e.g. </p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>rjson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rjson/man/fromJSON.html'>fromJSON</a></span><span class='op'>(</span><span class='va'>axes_json</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>parse_drawing</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 28 × 5
   line      x     y drawing          row_id
   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;int&gt;
 1 1        69    76 4842320119726080      1
 2 1        74    92 4842320119726080      2
 3 1        75   118 4842320119726080      3
 4 1        73   239 4842320119726080      4
 5 1        70   252 4842320119726080      5
 6 1        79   255 4842320119726080      6
 7 1        98   252 4842320119726080      7
 8 1       105   208 4842320119726080      8
 9 1       111   133 4842320119726080      9
10 1       110    73 4842320119726080     10
# … with 18 more rows</code></pre>
</div>
<p>A bunch of data processing has been done for us, but the data are not quite ready to be fed into an algorithm yet.</p>
<p>To do that, we would need a data frame with each row equal to one drawing and each column equal to one feature for that drawing, with an extra column for the drawing output.</p>
<p>To do this, we need to think about creating a standardized grid for storing our data on. However, the choice of grid is decision left up to us (you can think of this as feature engineering).</p>
<p>Another think we might want is for our data to be of a manageable size (again the choice of how we do this is another decision left up to us – more feature engineering).</p>
<h4 id="points-on-a-regular-grid">Points on a regular grid</h4>
<p>Let’s start by creating a regular grid of 256 <code>x</code> and <code>y</code> values.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>grid_dat</span> <span class='op'>=</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>256</span>,y<span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>256</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>grid_dat</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 65536     2</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>grid_dat</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 6 × 2
      x     y
  &lt;int&gt; &lt;int&gt;
1     1     1
2     2     1
3     3     1
4     4     1
5     5     1
6     6     1</code></pre>
</div>
<p>Now we could make each <code>x</code>, <code>y</code> value be a grid point with a join (this is overkill)</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>grid_axe</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>grid_dat</span>,<span class='va'>first_axe</span><span class='op'>)</span>
<span class='va'>grid_axe</span>
</code></pre>
</div>
<pre><code># A tibble: 65,537 × 5
       x     y line  drawing row_id
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;int&gt;
 1     1     1 &lt;NA&gt;  &lt;NA&gt;        NA
 2     2     1 &lt;NA&gt;  &lt;NA&gt;        NA
 3     3     1 &lt;NA&gt;  &lt;NA&gt;        NA
 4     4     1 &lt;NA&gt;  &lt;NA&gt;        NA
 5     5     1 &lt;NA&gt;  &lt;NA&gt;        NA
 6     6     1 &lt;NA&gt;  &lt;NA&gt;        NA
 7     7     1 &lt;NA&gt;  &lt;NA&gt;        NA
 8     8     1 &lt;NA&gt;  &lt;NA&gt;        NA
 9     9     1 &lt;NA&gt;  &lt;NA&gt;        NA
10    10     1 &lt;NA&gt;  &lt;NA&gt;        NA
# … with 65,527 more rows</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>grid_axe</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>line</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 2 × 2
  `is.na(line)`     n
  &lt;lgl&gt;         &lt;int&gt;
1 FALSE            27
2 TRUE          65510</code></pre>
</div>
<p>We see most of the lines are NA. Let’s add an indicator of whether a particular value is NA or not.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>grid_axe</span> <span class='op'>=</span> <span class='va'>grid_axe</span> <span class='op'>%&gt;%</span>
   <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>pixel <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>line</span><span class='op'>)</span>,<span class='fl'>0</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>grid_axe</span><span class='op'>$</span><span class='va'>pixel</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1]  4124  4909  7771  9328 11371 12660 12850 13947 14962 16710 16711
[12] 18543 18737 18746 19079 19270 19828 22037 23371 24205 30028 33904
[23] 53098 61002 64327 64355 65104</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>grid_axe</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>grid_axe</span><span class='op'>$</span><span class='va'>pixel</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>,<span class='op'>]</span>
</code></pre>
</div>
<pre><code># A tibble: 27 × 6
       x     y line  drawing          row_id pixel
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;             &lt;int&gt; &lt;dbl&gt;
 1    28    17 2     4842320119726080     16     1
 2    45    20 3     4842320119726080     26     1
 3    91    31 2     4842320119726080     17     1
 4   112    37 2     4842320119726080     25     1
 5   107    45 2     4842320119726080     18     1
 6   116    50 2     4842320119726080     24     1
 7    50    51 3     4842320119726080     27     1
 8   123    55 2     4842320119726080     23     1
 9   114    59 2     4842320119726080     19     1
10    70    66 1     4842320119726080     11     1
# … with 17 more rows</code></pre>
</div>
<h4 id="data-set-of-a-manageable-size">Data set of a manageable size</h4>
<p>Let’s try subsampling this down to a smaller image. We’ll use <code>Hmisc::cut2()</code> to cut a numeric variable into intervials. It’s similar to <code>cut()</code>, but left endpoints are inclusive and labels are of the form <code>[lower, upper)</code>, except that last interval is <code>[lower,upper]</code>. However, we will use <code>levels.mean=TRUE</code> to make the new categorical vector have levels attribute that is the group means of <code>grid_axe$x</code> instead of interval endpoint labels.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>grid_axe</span><span class='op'>$</span><span class='va'>xgroup</span> <span class='op'>=</span> <span class='fu'>Hmisc</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/Hmisc/man/cut2.html'>cut2</a></span><span class='op'>(</span><span class='va'>grid_axe</span><span class='op'>$</span><span class='va'>x</span>,g<span class='op'>=</span><span class='fl'>16</span>,levels.mean<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span> <span class='co'># g is number of quantile groups</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>grid_axe</span><span class='op'>$</span><span class='va'>xgroup</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
  9.000  25.500  41.500  57.500  72.999  88.500 104.500 120.500 
   4352    4096    4096    4096    3841    4096    4096    4096 
136.500 152.500 168.500 184.500 200.500 216.500 232.500 248.500 
   4096    4096    4096    4096    4096    4096    4096    4096 </code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>grid_axe</span><span class='op'>$</span><span class='va'>ygroup</span> <span class='op'>=</span> <span class='fu'>Hmisc</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/Hmisc/man/cut2.html'>cut2</a></span><span class='op'>(</span><span class='va'>grid_axe</span><span class='op'>$</span><span class='va'>y</span>,g<span class='op'>=</span><span class='fl'>16</span>,levels.mean<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>grid_axe</span>
</code></pre>
</div>
<pre><code># A tibble: 65,537 × 8
       x     y line  drawing row_id pixel xgroup    ygroup   
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;     &lt;fct&gt;    
 1     1     1 &lt;NA&gt;  &lt;NA&gt;        NA     0 &quot;  9.000&quot; &quot;  9.000&quot;
 2     2     1 &lt;NA&gt;  &lt;NA&gt;        NA     0 &quot;  9.000&quot; &quot;  9.000&quot;
 3     3     1 &lt;NA&gt;  &lt;NA&gt;        NA     0 &quot;  9.000&quot; &quot;  9.000&quot;
 4     4     1 &lt;NA&gt;  &lt;NA&gt;        NA     0 &quot;  9.000&quot; &quot;  9.000&quot;
 5     5     1 &lt;NA&gt;  &lt;NA&gt;        NA     0 &quot;  9.000&quot; &quot;  9.000&quot;
 6     6     1 &lt;NA&gt;  &lt;NA&gt;        NA     0 &quot;  9.000&quot; &quot;  9.000&quot;
 7     7     1 &lt;NA&gt;  &lt;NA&gt;        NA     0 &quot;  9.000&quot; &quot;  9.000&quot;
 8     8     1 &lt;NA&gt;  &lt;NA&gt;        NA     0 &quot;  9.000&quot; &quot;  9.000&quot;
 9     9     1 &lt;NA&gt;  &lt;NA&gt;        NA     0 &quot;  9.000&quot; &quot;  9.000&quot;
10    10     1 &lt;NA&gt;  &lt;NA&gt;        NA     0 &quot;  9.000&quot; &quot;  9.000&quot;
# … with 65,527 more rows</code></pre>
</div>
<p>Now I can convert these to numbers so we’ll have them later</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>grid_axe</span> <span class='op'>=</span> <span class='va'>grid_axe</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>xgroup <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>xgroup</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>7.5</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>ygroup <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>ygroup</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>7.5</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>grid_axe</span><span class='op'>$</span><span class='va'>xgroup</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
   1.5     18     34     50 65.499     81     97    113    129    145 
  4352   4096   4096   4096   3841   4096   4096   4096   4096   4096 
   161    177    193    209    225    241 
  4096   4096   4096   4096   4096   4096 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>grid_axe</span>
</code></pre>
</div>
<pre><code># A tibble: 65,537 × 8
       x     y line  drawing row_id pixel xgroup ygroup
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1     1     1 &lt;NA&gt;  &lt;NA&gt;        NA     0    1.5    1.5
 2     2     1 &lt;NA&gt;  &lt;NA&gt;        NA     0    1.5    1.5
 3     3     1 &lt;NA&gt;  &lt;NA&gt;        NA     0    1.5    1.5
 4     4     1 &lt;NA&gt;  &lt;NA&gt;        NA     0    1.5    1.5
 5     5     1 &lt;NA&gt;  &lt;NA&gt;        NA     0    1.5    1.5
 6     6     1 &lt;NA&gt;  &lt;NA&gt;        NA     0    1.5    1.5
 7     7     1 &lt;NA&gt;  &lt;NA&gt;        NA     0    1.5    1.5
 8     8     1 &lt;NA&gt;  &lt;NA&gt;        NA     0    1.5    1.5
 9     9     1 &lt;NA&gt;  &lt;NA&gt;        NA     0    1.5    1.5
10    10     1 &lt;NA&gt;  &lt;NA&gt;        NA     0    1.5    1.5
# … with 65,527 more rows</code></pre>
</div>
<p>Now we can average within groups of pixels to get a smaller image</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>small_axe</span> <span class='op'>=</span> <span class='va'>grid_axe</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>xgroup</span>,<span class='va'>ygroup</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>pixel<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>pixel</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>small_axe</span>
</code></pre>
</div>
<pre><code># A tibble: 256 × 3
# Groups:   xgroup [16]
   xgroup ygroup pixel
    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1    1.5    1.5     0
 2    1.5   18       0
 3    1.5   34       0
 4    1.5   50       0
 5    1.5   65.5     0
 6    1.5   81       0
 7    1.5   97       0
 8    1.5  113       0
 9    1.5  129       0
10    1.5  145       0
# … with 246 more rows</code></pre>
</div>
<p>Remember this was our original axe</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>first_axe</span>,<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>255</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_reverse</a></span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>255</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-24-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>Now we can look at the small version - it looks similar - whew! :)</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>small_axe</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>pixel</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>xgroup</span>, <span class='va'>ygroup</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>255</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_reverse</a></span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>255</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-25-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<h4 id="doing-this-for-all-axes-and-clouds">Doing this for all axes and clouds</h4>
<p>Now let’s do this for all axes and clouds</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>img_dat</span> <span class='op'>=</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>pixel<span class='op'>=</span><span class='cn'>NA</span>, type<span class='op'>=</span><span class='cn'>NA</span>, drawing<span class='op'>=</span><span class='cn'>NA</span>, pixel_number<span class='op'>=</span><span class='cn'>NA</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#First axes</span>

<span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>100</span><span class='op'>)</span><span class='op'>{</span>
    <span class='va'>tmp_draw</span> <span class='op'>=</span> <span class='fu'>rjson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rjson/man/fromJSON.html'>fromJSON</a></span><span class='op'>(</span><span class='va'>axes_json</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>parse_drawing</span><span class='op'>(</span><span class='op'>)</span>
    
    <span class='va'>grid_draw</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>grid_dat</span>,<span class='va'>tmp_draw</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
           <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>pixel <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>line</span><span class='op'>)</span>,<span class='fl'>0</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> 
    
    <span class='va'>grid_draw</span><span class='op'>$</span><span class='va'>xgroup</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/Hmisc/man/cut2.html'>cut2</a></span><span class='op'>(</span><span class='va'>grid_draw</span><span class='op'>$</span><span class='va'>x</span>,g<span class='op'>=</span><span class='fl'>16</span>,levels.mean<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
    <span class='va'>grid_draw</span><span class='op'>$</span><span class='va'>ygroup</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/Hmisc/man/cut2.html'>cut2</a></span><span class='op'>(</span><span class='va'>grid_draw</span><span class='op'>$</span><span class='va'>y</span>,g<span class='op'>=</span><span class='fl'>16</span>,levels.mean<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
    
    <span class='va'>small_draw</span> <span class='op'>=</span> <span class='va'>grid_draw</span> <span class='op'>%&gt;%</span> 
        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>xgroup <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>xgroup</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>7.5</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>ygroup <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>ygroup</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>7.5</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>xgroup</span>,<span class='va'>ygroup</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>pixel<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>pixel</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>pixel</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>type<span class='op'>=</span><span class='st'>"axe"</span>,drawing<span class='op'>=</span><span class='va'>i</span>,pixel_number<span class='op'>=</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/ranking.html'>row_number</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
    <span class='va'>img_dat</span> <span class='op'>=</span> <span class='va'>img_dat</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span><span class='va'>small_draw</span><span class='op'>)</span>
<span class='op'>}</span>



<span class='co'>#Then clouds</span>

<span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>100</span><span class='op'>)</span><span class='op'>{</span>
    <span class='va'>tmp_draw</span> <span class='op'>=</span> <span class='fu'>rjson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rjson/man/fromJSON.html'>fromJSON</a></span><span class='op'>(</span><span class='va'>clouds_json</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>parse_drawing</span><span class='op'>(</span><span class='op'>)</span>
    
    <span class='va'>grid_draw</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>grid_dat</span>,<span class='va'>tmp_draw</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
           <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>pixel <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>line</span><span class='op'>)</span>,<span class='fl'>0</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> 
    
    <span class='va'>grid_draw</span><span class='op'>$</span><span class='va'>xgroup</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/Hmisc/man/cut2.html'>cut2</a></span><span class='op'>(</span><span class='va'>grid_draw</span><span class='op'>$</span><span class='va'>x</span>,g<span class='op'>=</span><span class='fl'>16</span>,levels.mean<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
    <span class='va'>grid_draw</span><span class='op'>$</span><span class='va'>ygroup</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/Hmisc/man/cut2.html'>cut2</a></span><span class='op'>(</span><span class='va'>grid_draw</span><span class='op'>$</span><span class='va'>y</span>,g<span class='op'>=</span><span class='fl'>16</span>,levels.mean<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
    
    <span class='va'>small_draw</span> <span class='op'>=</span> <span class='va'>grid_draw</span> <span class='op'>%&gt;%</span> 
        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>xgroup <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>xgroup</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>7.5</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>ygroup <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>ygroup</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>7.5</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>xgroup</span>,<span class='va'>ygroup</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>pixel<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>pixel</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>pixel</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>type<span class='op'>=</span><span class='st'>"cloud"</span>,drawing<span class='op'>=</span><span class='va'>i</span>,pixel_number<span class='op'>=</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/ranking.html'>row_number</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
    <span class='va'>img_dat</span> <span class='op'>=</span> <span class='va'>img_dat</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span><span class='va'>small_draw</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Now let’s look at this new data frame</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>img_dat</span> <span class='op'>=</span> <span class='va'>img_dat</span><span class='op'>[</span><span class='op'>-</span><span class='fl'>1</span>,<span class='op'>]</span>
<span class='va'>img_dat</span>
</code></pre>
</div>
<pre><code># A tibble: 51,200 × 4
   pixel type  drawing pixel_number
   &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt;        &lt;int&gt;
 1     0 axe         1            1
 2     0 axe         1            2
 3     0 axe         1            3
 4     0 axe         1            4
 5     0 axe         1            5
 6     0 axe         1            6
 7     0 axe         1            7
 8     0 axe         1            8
 9     0 axe         1            9
10     0 axe         1           10
# … with 51,190 more rows</code></pre>
</div>
<p>We can use <code>pivot_wider()</code> and viola we finally have a processed data set!</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyr.tidyverse.org'>tidyr</a></span><span class='op'>)</span>
<span class='va'>img_final</span> <span class='op'>&lt;-</span> 
  <span class='va'>img_dat</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_wider.html'>pivot_wider</a></span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='va'>pixel_number</span>, values_from <span class='op'>=</span> <span class='va'>pixel</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>img_final</span><span class='op'>)</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"type"</span>,<span class='st'>"drawing"</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"pixel"</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fl'>256</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>img_final</span> 
</code></pre>
</div>
<pre><code># A tibble: 200 × 258
   type  drawing  pixel1  pixel2  pixel3  pixel4 pixel5  pixel6
   &lt;chr&gt;   &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
 1 axe         1 0       0       0       0            0 0      
 2 axe         2 0       0.00368 0.00368 0            0 0      
 3 axe         3 0       0.00368 0       0            0 0.00368
 4 axe         4 0.00391 0       0.00391 0            0 0      
 5 axe         5 0       0       0       0.00368      0 0      
 6 axe         6 0       0       0.00391 0            0 0      
 7 axe         7 0       0       0.00781 0            0 0      
 8 axe         8 0       0       0.00391 0            0 0      
 9 axe         9 0.00781 0       0.00391 0            0 0      
10 axe        10 0.0117  0       0       0.00391      0 0      
# … with 190 more rows, and 250 more variables: pixel7 &lt;dbl&gt;,
#   pixel8 &lt;dbl&gt;, pixel9 &lt;dbl&gt;, pixel10 &lt;dbl&gt;, pixel11 &lt;dbl&gt;,
#   pixel12 &lt;dbl&gt;, pixel13 &lt;dbl&gt;, pixel14 &lt;dbl&gt;, pixel15 &lt;dbl&gt;,
#   pixel16 &lt;dbl&gt;, pixel17 &lt;dbl&gt;, pixel18 &lt;dbl&gt;, pixel19 &lt;dbl&gt;,
#   pixel20 &lt;dbl&gt;, pixel21 &lt;dbl&gt;, pixel22 &lt;dbl&gt;, pixel23 &lt;dbl&gt;,
#   pixel24 &lt;dbl&gt;, pixel25 &lt;dbl&gt;, pixel26 &lt;dbl&gt;, pixel27 &lt;dbl&gt;,
#   pixel28 &lt;dbl&gt;, pixel29 &lt;dbl&gt;, pixel30 &lt;dbl&gt;, pixel31 &lt;dbl&gt;, …</code></pre>
</div>
<h2 id="splitting-into-training-testing-validation">Splitting into training, testing, validation</h2>
<p>Now that we have our data processed an important step is to break the data up into a training, testing, and validation set. In general, people use these words in different ways:</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="../../images/ttv.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<p>I actually like this proposal to call them “training, tuning, and testing” sets, so let’s use that.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="../../images/ttt.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>But the reason for this splitting is that we want to avoid being overly optimistic or “overfitting” on the training data. That would prevent us from predicting well on new samples.</p>
<h3 id="overfitting">Overfitting</h3>
<p>Here is a funny example from <a href="https://xkcd.com/1122/">XKCD</a> to illustrate overfitting</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="../../images/xkcd112.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<p>The basic idea is that if you keep adding predictors, the model will “predict well” on the data you have, no matter how well we expect it to do in the future.</p>
<p>The key thing to keep in mind is that there are <strong>two types of variation</strong> in any data set, the “signal” and the “noise”. Using math notation, imagine that the “real” model for a data set is:</p>
<p><span class="math display">\[y_i = \underbrace{g(\vec{x}_i)}_{signal} + \underbrace{e_i}_{noise}\]</span></p>
<p>Let’s use a concrete, simple example:</p>
<p><span class="math display">\[y_i = \underbrace{x^2}_{signal} + \underbrace{e_i}_{noise}\]</span></p>
<p>Imagine we want to “learn” a model of the form:</p>
<p><span class="math display">\[y_i = \sum_{k=1}^K b_k g_k(x_i) + e_i\]</span></p>
<p>Then, the model</p>
<ul>
<li><strong>Fits</strong> if <span class="math inline">\(\sum_{k=1}^K b_k g_k(x) \approx x^2\)</span>.</li>
<li><strong>Overfits</strong> if <span class="math inline">\(\sum_{k=1}^K b_k g_k(x) \approx x^2 + e_i\)</span></li>
<li><strong>Underfits</strong> if <span class="math inline">\(\sum_{k=1}^K b_k g_k(x) \neq x^2\)</span></li>
</ul>
<p>Let’s simulate from the example above to give a better idea:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tibble.tidyverse.org/'>tibble</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>splines</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://modelr.tidyverse.org'>modelr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>=</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>30</span><span class='op'>)</span>,y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>30</span>,mean<span class='op'>=</span><span class='va'>x</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>dat</span>,<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>x</span>,y<span class='op'>=</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-31-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>Now let’s fit three models to this data. One that underfits, one that fits, and one that overfits.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># To make plotting easier later</span>
<span class='va'>dat</span>  <span class='op'>=</span> <span class='va'>dat</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>

<span class='va'>lm_under</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>x</span>,data<span class='op'>=</span><span class='va'>dat</span><span class='op'>)</span>
<span class='co'># using natural splines to model a non-linear relationship with piecewise cubic polynomials</span>
<span class='co'># can specificy df (degrees of freedom) and then ns() chooses (df - 1) interior knots at certain quantiles of x</span>
<span class='va'>lm_fits</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/splines/ns.html'>ns</a></span><span class='op'>(</span><span class='va'>x</span>,df<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>,data<span class='op'>=</span><span class='va'>dat</span><span class='op'>)</span> 
<span class='va'>lm_over</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/splines/ns.html'>ns</a></span><span class='op'>(</span><span class='va'>x</span>,df<span class='op'>=</span><span class='fl'>10</span><span class='op'>)</span>,data<span class='op'>=</span><span class='va'>dat</span><span class='op'>)</span>

<span class='va'>dat_pred</span> <span class='op'>=</span> <span class='va'>dat</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://modelr.tidyverse.org/reference/add_predictions.html'>add_predictions</a></span><span class='op'>(</span><span class='va'>lm_fits</span>,<span class='st'>"fits"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://modelr.tidyverse.org/reference/add_predictions.html'>add_predictions</a></span><span class='op'>(</span><span class='va'>lm_under</span>,<span class='st'>"under"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://modelr.tidyverse.org/reference/add_predictions.html'>add_predictions</a></span><span class='op'>(</span><span class='va'>lm_over</span>,<span class='st'>"over"</span><span class='op'>)</span>

<span class='va'>dat_pred</span>  <span class='op'>=</span> <span class='va'>dat_pred</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span><span class='op'>)</span>, names_to <span class='op'>=</span> <span class='st'>"fit_type"</span>, values_to <span class='op'>=</span> <span class='st'>"fit"</span><span class='op'>)</span>

<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>dat_pred</span>,<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>x</span>,y<span class='op'>=</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>x</span>,y<span class='op'>=</span><span class='va'>fit</span>,group<span class='op'>=</span><span class='va'>fit_type</span>,color<span class='op'>=</span><span class='va'>fit_type</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-32-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>You can kind of see that the blue line misses the signal, the red line fits pretty well, and the green line seems to capture a little too much of the noise. If we look at the errors of each approach we get:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat_pred</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>res2 <span class='op'>=</span> <span class='op'>(</span><span class='va'>y</span> <span class='op'>-</span> <span class='va'>fit</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>fit_type</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>rmse <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>res2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 3 × 2
  fit_type  rmse
  &lt;chr&gt;    &lt;dbl&gt;
1 fits      6.10
2 over      4.58
3 under     9.12</code></pre>
</div>
<p>It looks like the overfitting approach was best, but we can probably guess that won’t work on a new data set:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat2</span> <span class='op'>=</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>30</span><span class='op'>)</span>,y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>30</span>,mean<span class='op'>=</span><span class='va'>x</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span> 
<span class='va'>dat2_pred</span> <span class='op'>=</span> <span class='va'>dat2</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://modelr.tidyverse.org/reference/add_predictions.html'>add_predictions</a></span><span class='op'>(</span><span class='va'>lm_fits</span>,<span class='st'>"fits"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://modelr.tidyverse.org/reference/add_predictions.html'>add_predictions</a></span><span class='op'>(</span><span class='va'>lm_under</span>,<span class='st'>"under"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://modelr.tidyverse.org/reference/add_predictions.html'>add_predictions</a></span><span class='op'>(</span><span class='va'>lm_over</span>,<span class='st'>"over"</span><span class='op'>)</span>

<span class='va'>dat2_pred</span> <span class='op'>&lt;-</span>  
  <span class='va'>dat2_pred</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span><span class='op'>)</span>, names_to <span class='op'>=</span> <span class='st'>"fit_type"</span>, values_to <span class='op'>=</span> <span class='st'>"fit"</span><span class='op'>)</span>

<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>dat2_pred</span>,<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>x</span>,y<span class='op'>=</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>x</span>,y<span class='op'>=</span><span class='va'>fit</span>,group<span class='op'>=</span><span class='va'>fit_type</span>,color<span class='op'>=</span><span class='va'>fit_type</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-34-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>Where the best model will be the one that captures the signal (which remains fixed) and not the noise (which changes).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat2_pred</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>res2 <span class='op'>=</span> <span class='op'>(</span><span class='va'>y</span> <span class='op'>-</span> <span class='va'>fit</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>fit_type</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>rmse <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>res2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 3 × 2
  fit_type  rmse
  &lt;chr&gt;    &lt;dbl&gt;
1 fits      5.45
2 over      6.03
3 under     7.86</code></pre>
</div>
<h3 id="bias-variance-tradeoff">Bias variance tradeoff</h3>
<div class="keyideas">
<p><strong>Overfitting</strong> is related to another general concept - the <strong>bias variance trade-off</strong>.</p>
<p>In general, the more predictors you have in a model the lower the bias but the higher the variance. This is called the “bias-variance trade-off”.</p>
</div>
<p>To see this, let’s fit these models in 100 simulated data sets and see what the models predict for a x value of 0 (the prediction should equal 0).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>over</span> <span class='op'>=</span> <span class='va'>under</span> <span class='op'>=</span> <span class='va'>fits</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>100</span><span class='op'>)</span>
<span class='va'>ex_dat</span> <span class='op'>=</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>
<span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>100</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>new_dat</span> <span class='op'>=</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>30</span><span class='op'>)</span>,y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>30</span>,mean<span class='op'>=</span><span class='va'>x</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>   
  <span class='va'>lm_under</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>x</span>,data<span class='op'>=</span><span class='va'>new_dat</span><span class='op'>)</span>
  <span class='va'>lm_fits</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/splines/ns.html'>ns</a></span><span class='op'>(</span><span class='va'>x</span>,df<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>,data<span class='op'>=</span><span class='va'>new_dat</span><span class='op'>)</span>
  <span class='va'>lm_over</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/splines/ns.html'>ns</a></span><span class='op'>(</span><span class='va'>x</span>,df<span class='op'>=</span><span class='fl'>10</span><span class='op'>)</span>,data<span class='op'>=</span><span class='va'>new_dat</span><span class='op'>)</span>
  <span class='va'>over</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>lm_over</span>,<span class='va'>ex_dat</span><span class='op'>)</span>
  <span class='va'>under</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>lm_under</span>,<span class='va'>ex_dat</span><span class='op'>)</span>
  <span class='va'>fits</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>lm_fits</span>,<span class='va'>ex_dat</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>results</span> <span class='op'>=</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span><span class='va'>over</span>,<span class='va'>under</span>,<span class='va'>fits</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>names_to <span class='op'>=</span> <span class='st'>"type"</span>, values_to <span class='op'>=</span> <span class='st'>"prediction"</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>over</span>,<span class='va'>under</span>,<span class='va'>fits</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>The <code>results</code> show that when we fit the <strong>exact right model</strong> we do best (no surprise there!).</p>
<p>When the model is <strong>too complex</strong> we get low bias (values predicted close to zero on average) but high variance.</p>
<p>When the model is <strong>not complex enough</strong> we get high bias (values predicted away from zero) but low variance.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>results</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y<span class='op'>=</span><span class='va'>prediction</span>,group<span class='op'>=</span><span class='va'>type</span>,fill<span class='op'>=</span><span class='va'>type</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_boxplot.html'>geom_boxplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-37-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>In general you will not know the true model, so the goal is to try to pick a model that gives a happy medium on the bias-variance trade-off (of course depending on your goals).</p>
<h3 id="what-do-you-do-in-trainingtuningtesting">What do you do in training/tuning/testing</h3>
<p>Imagine we have broken the data into three components: <span class="math inline">\(X_{tr}, X_{tu}, X_{te}\)</span>. Now we need to “fit” the model. Let’s briefly talk about what this means. A machine learning model has two parts:</p>
<ol type="1">
<li>An algorithm</li>
<li>A set of parameters</li>
</ol>
<p>The algorithm would be something like regression models with splines:</p>
<p><span class="math display">\[y_i = \sum_{k=1}^K b_k g_k(x_i) + e_i\]</span></p>
<p>And the parameters would be the choices of <span class="math inline">\(b_k\)</span>, <span class="math inline">\(g_k\)</span> and <span class="math inline">\(K\)</span>. These parameters are “fit” by estimating them from the data or fixing them in advance.</p>
<ul>
<li><strong>Training</strong> - In the training set, you try different algorithms, estimate their parameters, and see which one works best.</li>
<li><strong>Tuning</strong> - Once you have settled on a single algorithm (or a small set of algorithms), you use the tuning set to estimate which parameters work best outside of the training sample you originally built on.</li>
<li><strong>Testing</strong> - Once your algorithm and all your parameters for your model are fixed, then you apply that fitted model just one time to the test set to evaluate the error rate for your model realistically.</li>
</ul>
<h3 id="cross-validation">Cross validation</h3>
<p>Within the training set you are choosing between algorithms and parameters, but like we saw above, if you use the whole training set you may end up overfitting to the noise in the data. So when selecting algorithms and parameters, you need some way to make sure you don’t just pick the algorithm that is most overfit.</p>
<p>The typical way people do this is by cross-validation (figure borrowed from Rafa’s <a href="https://rafalab.github.io/dsbook/cross-validation-1.html">Data Science Book</a>). K-fold cross validation just splits up the training set into K pieces. You build the model on part of the training data and apply it to the rest. This gives you a better evaluation of the out of sample error - so will allow you to rank models in a better way.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="../../images/cross-validation.png" width="60%" style="display: block; margin: auto;" /></p>
</div>
<p>You can also use the bootstrap. But you need to <a href="https://www.jstor.org/stable/2965703">adjust for the fact that the training and testing sets are random samples</a>.</p>
<h4 id="back-to-quick-draw-1">Back to quick draw</h4>
<p>Here we are going to simply use training and testing using the <code>createDataPartition()</code> function in the <a href="http://topepo.github.io/caret/index.html">caret package</a> with the argument <code>p</code> being the percentages of data that goes into training:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>train_set</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/createDataPartition.html'>createDataPartition</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>img_final</span><span class='op'>$</span><span class='va'>type</span>, p <span class='op'>=</span> <span class='fl'>0.5</span>,
                                list<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span>

<span class='va'>train_dat</span> <span class='op'>=</span> <span class='va'>img_final</span><span class='op'>[</span><span class='va'>train_set</span>,<span class='op'>]</span>
<span class='va'>test_dat</span> <span class='op'>=</span> <span class='va'>img_final</span><span class='op'>[</span><span class='op'>-</span><span class='va'>train_set</span>,<span class='op'>]</span>
</code></pre>
</div>
</div>
<p>We leave the test set alone <em>until the very end</em>!</p>
<h2 id="model-selection-and-fitting">Model selection and fitting</h2>
<p>A lot of machine learning is considering variations on the equation:</p>
<p><span class="math display">\[d(y,f(\vec{x}))\]</span></p>
<p>where the things we are varying is the choice of distance metric <span class="math inline">\(d()\)</span> which we have already discussed. We have talked a lot less about varying <span class="math inline">\(f()\)</span> which is the most common topic for many machine learning books. Here we will briefly review a couple of the key algorithms.</p>
<p>The first thing to keep in mind is that with well engineered features, often simple algorithms due almost as well as more advanced algorithms.</p>
<p>The other thing to keep in mind with these types of algorithms is that there are often important tradeoffs.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="../../images/tradeoffs.png" width="60%" style="display: block; margin: auto;" /></p>
</div>
<p>The important tradeoffs are:</p>
<ul>
<li>Interpretability versus accuracy</li>
<li>Speed versus accuracy</li>
<li>Simplicity versus accuracy</li>
<li>Scalability versus accuracy</li>
</ul>
<h3 id="types-of-models">Types of models</h3>
<p>There are a few key ideas you should know about that define most regression models you will run into in practice.</p>
<ul>
<li>Regression</li>
<li>Trees</li>
<li>Ensembling</li>
<li>Neural Networks</li>
</ul>
<p>Today we will <em>briefly</em> demonstrate trees.</p>
<h3 id="trees">Trees</h3>
<p><a href="https://www.stat.cmu.edu/~cshalizi/350/lectures/22/lecture-22.pdf">Classification and regression trees</a> are an extremely popular approach to prediction. The basic algorithm for a classification tree is the following:</p>
<ol type="1">
<li>Start with all variables in one group</li>
<li>Find the variable/split that best separates the outcomes</li>
<li>Divide the data into two groups (“leaves”) on that split (“node”)</li>
<li>Within each split, find the best variable/split that separates the outcomes</li>
<li>Continue until the groups are too small or sufficiently “pure”</li>
</ol>
<p>This is an example tree:</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="../../images/obama-clinton.jpg" width="90%" style="display: block; margin: auto;" /></p>
</div>
<p>The big question is how to define “best separates the outcomes” in Step 4 of the general algorithm. For continuous data you might minimize the <a href="https://rafalab.github.io/dsbook/trees-and-random-forests.html">residual sum of squares in each group</a>. For binary data you might measure <a href="https://en.wikipedia.org/wiki/Decision_tree_learning">misclassification or information gain</a>.</p>
<ul>
<li><strong>Strengths</strong> - Trees are usually easy to understand and can be fit quickly.</li>
<li><strong>Weaknesses</strong> - Trees have a tendency not to be terribly accurate compared to some other methods and may overfit.</li>
</ul>
<h4 id="our-example">Our example</h4>
<p>Based on these plots of a few of the features:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>train_dat</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>type</span>,y<span class='op'>=</span><span class='va'>pixel1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_violin.html'>geom_violin</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_log10</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-39-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>train_dat</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>type</span>,y<span class='op'>=</span><span class='va'>pixel2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_violin.html'>geom_violin</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_log10</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-40-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>We should be able to do ok for this model fitting. We can fit models using the <a href="http://topepo.github.io/caret/index.html">caret package</a>. The caret package simplifies a lot of model fitting for machine learning. We can use the <code>train</code> command to do this in R.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mod</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>type</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.</span>, data<span class='op'>=</span><span class='va'>train_dat</span>,method<span class='op'>=</span><span class='st'>"rpart"</span><span class='op'>)</span>
<span class='va'>mod</span>
</code></pre>
</div>
<pre><code>CART 

100 samples
257 predictors
  2 classes: &#39;axe&#39;, &#39;cloud&#39; 

No pre-processing
Resampling: Bootstrapped (25 reps) 
Summary of sample sizes: 100, 100, 100, 100, 100, 100, ... 
Resampling results across tuning parameters:

  cp    Accuracy   Kappa    
  0.14  0.8385178  0.6751338
  0.26  0.7900434  0.5798719
  0.54  0.6274736  0.2868931

Accuracy was used to select the optimal model using the
 largest value.
The final value used for the model was cp = 0.14.</code></pre>
</div>
<p>Here you can see we have reasonable accuracy, this accuracy is estimated using bootstrapping only the training set. We can look at the final model fit after model selection using the <code>finalModel</code> argument.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mod</span><span class='op'>$</span><span class='va'>finalModel</span>
</code></pre>
</div>
<pre><code>n= 100 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

1) root 100 50 axe (0.50000000 0.50000000)  
  2) pixel246&lt; 0.001953125 73 23 axe (0.68493151 0.31506849)  
    4) pixel243&lt; 0.001953125 58  9 axe (0.84482759 0.15517241) *
    5) pixel243&gt;=0.001953125 15  1 cloud (0.06666667 0.93333333) *
  3) pixel246&gt;=0.001953125 27  0 cloud (0.00000000 1.00000000) *</code></pre>
</div>
<p>You can use the <code>rpart.plot</code> package to visualize what is actually going on here.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html'>rpart.plot</a></span><span class='op'>(</span><span class='va'>mod</span><span class='op'>$</span><span class='va'>finalModel</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-43-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<h2 id="model-evaluation">Model evaluation</h2>
<p>The last step is model evaluation. A good model evaluation includes the components:</p>
<ol type="1">
<li>Evaluation of the model predictions based on the goal you stated at the beginning of the problem.</li>
<li>Exploratory analysis of predictions to ensure that there aren’t obvious problems</li>
<li>Consideration of the practical and ethical consequences of deploying your model.</li>
</ol>
<div class="keyideas">
<p><strong>why is this important?</strong></p>
<p>A while back Amazon developed an AI algorithm for predicting who they should hire. They did a good job of evaluating criteria 1 - they knew they could accurately predict in their training set.</p>
<p>However, they didn’t do exploratory analysis to identify what their model was using to make predictions. They also didn’t do a careful job of evaluating the implications of their model in terms of bias.</p>
<p>This <a href="https://www.reuters.com/article/us-amazon-com-jobs-automation-insight/amazon-scraps-secret-ai-recruiting-tool-that-showed-bias-against-women-idUSKCN1MK08G">led to some major problems</a>.</p>
</div>
<h4 id="back-to-model-evaluation">back to model evaluation</h4>
<p>Before evaluating our model in the test set, we want to understand what is going on with our prediction. This is an active and open area of research: the interpretation of results from black box machine learning algorithms. We can do this in a couple of ways. One approach that has seen some traction is <a href="https://homes.cs.washington.edu/~marcotcr/blog/lime/">locally interpretable model agnostic explanations</a> (lime). This approach fits very simple local models to approximate the complicated model in a local neighborhood.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="../../images/local-model.png" width="60%" style="display: block; margin: auto;" /></p>
</div>
<p>Then for each prediction <a href="https://iamkbpark.com/2018/01/22/deep-learning-with-keras-lime-in-r/">you can see</a> how much the features are positively or negatively correlated with the complex model near that prediction. To do this, you can use the <a href="https://cran.r-project.org/web/packages/lime/vignettes/Understanding_lime.html">lime</a> package.</p>
<p>Or you can start looking at the data for individual features.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>img_final</span>,<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>type</span>,y<span class='op'>=</span><span class='va'>pixel246</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_violin.html'>geom_violin</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_log10</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-44-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>We can also look at where this pixel would be in the image:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>16</span>,y<span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>16</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>246</span>,<span class='op'>]</span>
</code></pre>
</div>
<pre><code>    x  y
246 6 16</code></pre>
</div>
<p>And plot it</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>X</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0</span>,nrow<span class='op'>=</span><span class='fl'>16</span>,ncol<span class='op'>=</span><span class='fl'>16</span><span class='op'>)</span>
<span class='va'>X</span><span class='op'>[</span><span class='fl'>6</span>,<span class='fl'>16</span><span class='op'>]</span> <span class='op'>=</span> <span class='fl'>1</span>
<span class='fu'><a href='https://rdrr.io/pkg/pheatmap/man/pheatmap.html'>pheatmap</a></span><span class='op'>(</span><span class='va'>X</span>,cluster_cols<span class='op'>=</span><span class='cn'>FALSE</span>,cluster_rows<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-46-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>We can also figure out which of the images are misclassified and look at them</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>missed</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>mod</span>,<span class='va'>train_dat</span><span class='op'>)</span> <span class='op'>!=</span> <span class='va'>train_dat</span><span class='op'>$</span><span class='va'>type</span><span class='op'>)</span>
<span class='va'>missed_imgs</span> <span class='op'>=</span> <span class='va'>train_dat</span><span class='op'>[</span><span class='va'>missed</span>,<span class='op'>]</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>type</span>,<span class='va'>drawing</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>Let’s look at one of the missed images</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>missed_imgs</span>  <span class='op'>=</span> <span class='va'>missed_imgs</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>type</span><span class='op'>==</span><span class='st'>"axe"</span><span class='op'>)</span> 

<span class='fu'>rjson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rjson/man/fromJSON.html'>fromJSON</a></span><span class='op'>(</span><span class='va'>axes_json</span><span class='op'>[[</span><span class='va'>missed_imgs</span><span class='op'>$</span><span class='va'>drawing</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>parse_drawing</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>group <span class='op'>=</span> <span class='va'>line</span><span class='op'>)</span>, lwd<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>255</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_reverse</a></span><span class='op'>(</span>limits<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>255</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="introduction-to-machine-learning_files/figure-html5/unnamed-chunk-48-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>The first is not clear why we missed this? Maybe just because the model is too sparse? This would be something we’d explore more carefully.</p>
<p>The last step is to apply the predictions in the test set. You only do this once, but it gives you the best estimate of the out of sample error rate you’d see in practice.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>test_dat</span><span class='op'>$</span><span class='va'>type</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>mod</span>,<span class='va'>test_dat</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction axe cloud
     axe    45     5
     cloud  13    37
                                          
               Accuracy : 0.82            
                 95% CI : (0.7305, 0.8897)
    No Information Rate : 0.58            
    P-Value [Acc &gt; NIR] : 2.857e-07       
                                          
                  Kappa : 0.64            
                                          
 Mcnemar&#39;s Test P-Value : 0.09896         
                                          
            Sensitivity : 0.7759          
            Specificity : 0.8810          
         Pos Pred Value : 0.9000          
         Neg Pred Value : 0.7400          
             Prevalence : 0.5800          
         Detection Rate : 0.4500          
   Detection Prevalence : 0.5000          
      Balanced Accuracy : 0.8284          
                                          
       &#39;Positive&#39; Class : axe             
                                          </code></pre>
</div>
<p>This accuracy is usually slightly lower than the accuracy in the training data.</p>
<h1 id="post-lecture-materials">Post-lecture materials</h1>
<h3 id="additional-resources">Additional Resources</h3>
<div class="resources">
<ul>
<li><a href="https://rafalab.github.io/dsbook/introduction-to-machine-learning.html" class="uri">https://rafalab.github.io/dsbook/introduction-to-machine-learning.html</a></li>
</ul>
</div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="disqus-comments">
      <i class="fas fa-comments"></i>
      &nbsp;
      <span class="disqus-comment-count" data-disqus-identifier="posts/2021-10-19-introduction-to-machine-learning/">Comment on this article</span>
    </span>
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://twitter.com/share?text=Introduction%20to%20machine%20learning&amp;url=https%3A%2F%2Fstephaniehicks.com%2Fjhustatcomputing2021%2Fposts%2F2021-10-19-introduction-to-machine-learning%2F">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fstephaniehicks.com%2Fjhustatcomputing2021%2Fposts%2F2021-10-19-introduction-to-machine-learning%2F&amp;title=Introduction%20to%20machine%20learning">
        <i class="fab fa-linkedin"></i>
      </a>
    </span>
  </p>
  <script id="dsq-count-scr" src="https://jhustatcomputing2021.disqus.com/count.js" async></script>
  <div id="disqus_thread" class="hidden"></div>
  <script type="text/javascript" cookie-consent="functionality">
var disqus_config = function () {
  this.page.url = 'https://stephaniehicks.com/jhustatcomputing2021/posts/2021-10-19-introduction-to-machine-learning/';
  this.page.identifier = 'posts/2021-10-19-introduction-to-machine-learning/';
};
(function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://jhustatcomputing2021.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Hicks (2021, Oct. 19). Statistical Computing: Introduction to machine learning. Retrieved from https://stephaniehicks.com/jhustatcomputing2021/posts/2021-10-19-introduction-to-machine-learning/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{hicks2021introduction,
  author = {Hicks, Stephanie},
  title = {Statistical Computing: Introduction to machine learning},
  url = {https://stephaniehicks.com/jhustatcomputing2021/posts/2021-10-19-introduction-to-machine-learning/},
  year = {2021}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
